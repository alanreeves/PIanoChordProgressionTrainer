<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pianochords.uk</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Custom Styles -->
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Header Bar -->
    <header class="app-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-6">
                    <h1 class="app-title">pianochords.uk</h1>
                </div>
                <div class="col-6 text-end">
                    <!-- Audio On/Off toggle button in header -->
                    <div class="form-check form-switch d-inline-block me-2">
                        <input class="form-check-input" type="checkbox" id="header-play-sound">
                        <label class="form-check-label text-white" for="header-play-sound">
                            <span class="fw-bold">Audio On/Off</span>
                        </label>
                    </div>
                    <button id="settings-btn" class="btn btn-sm btn-outline-light me-2">
                        <i class="bi bi-gear-fill me-1"></i>Settings
                    </button>
                    <button id="help-btn" class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#helpModal">
                        <i class="bi bi-question-circle me-1"></i>Help
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">How to Use pianochords.uk</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <iframe id="helpContentFrame" src="help.html" width="100%" height="500" frameborder="0"></iframe>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Dropdown Panel -->
    <div class="settings-dropdown-container">
        <div class="settings-overlay"></div>
        <div class="settings-dropdown">
            <div class="settings-dropdown-header">
                <h5><i class="bi bi-gear-fill me-2"></i>Settings</h5>
                <button class="settings-close-btn">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="settings-dropdown-content">
                <!-- MOVED: Playback Controls to the top -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">Playback Controls</h5>
                    <div class="row playback-row">
                        <div class="col-12 mb-2">
                            <div class="form-check form-switch d-flex align-items-center">
                                <input class="form-check-input" type="checkbox" id="play-sound">
                                <label class="form-check-label" for="play-sound">
                                    <span class="fw-bold">Audio On/Off</span>
                                </label>
                                <div class="compact-volume-control">
                                    <label for="chord-volume" class="small">Vol</label>
                                    <input type="range" class="compact-range" id="chord-volume" min="0" max="1" step="0.01" value="0.5">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="arpeggiate-chord">
                                <label class="form-check-label" for="arpeggiate-chord">
                                    <span class="fw-bold">Arpeggiate</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="d-flex align-items-center">
                                <label for="octave-selector" class="me-2">
                                    <span class="fw-bold">Octave:</span>
                                </label>
                                <select id="octave-selector" class="form-select form-select-sm" style="width: auto; min-width: 70px;">
                                    <option value="3">3 (Low)</option>
                                    <option value="4" selected>4 (Middle)</option>
                                    <option value="5">5 (High)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="form-check form-switch d-flex align-items-center">
                                <input class="form-check-input" type="checkbox" id="metronome">
                                <label class="form-check-label" for="metronome">
                                    <span class="fw-bold">Metronome</span>
                                </label>
                                <div class="compact-volume-control">
                                    <label for="metronome-volume" class="small">Vol</label>
                                    <input type="range" class="compact-range" id="metronome-volume" min="0" max="1" step="0.01" value="0.5">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                
                <!-- Key Selection -->
                <div class="row mb-4">
                    <div class="col-12 mb-3">
                        <h5 class="text-primary mb-2">Key</h5>
                        <div class="d-flex justify-content-start">
                            <select id="key-select" class="form-select">
                                <!-- Major keys -->
                                <option value="C">C Major</option>
                                <option value="C#">C# Major</option>
                                <option value="Db">Db Major</option>
                                <option value="D">D Major</option>
                                <option value="D#">D# Major</option>
                                <option value="Eb">Eb Major</option>
                                <option value="E">E Major</option>
                                <option value="F">F Major</option>
                                <option value="F#">F# Major</option>
                                <option value="Gb">Gb Major</option>
                                <option value="G">G Major</option>
                                <option value="G#">G# Major</option>
                                <option value="Ab">Ab Major</option>
                                <option value="A">A Major</option>
                                <option value="A#">A# Major</option>
                                <option value="Bb">Bb Major</option>
                                <option value="B">B Major</option>
                                
                                <!-- Minor keys -->
                                <option value="Cm">C Minor</option>
                                <option value="C#m">C# Minor</option>
                                <option value="Dbm">Db Minor</option>
                                <option value="Dm">D Minor</option>
                                <option value="D#m">D# Minor</option>
                                <option value="Ebm">Eb Minor</option>
                                <option value="Em">E Minor</option>
                                <option value="Fm">F Minor</option>
                                <option value="F#m">F# Minor</option>
                                <option value="Gbm">Gb Minor</option>
                                <option value="Gm">G Minor</option>
                                <option value="G#m">G# Minor</option>
                                <option value="Abm">Ab Minor</option>
                                <option value="Am">A Minor</option>
                                <option value="A#m">A# Minor</option>
                                <option value="Bbm">Bb Minor</option>
                                <option value="Bm">B Minor</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Hand Selection -->
                    <div class="col-12 mb-3">
                        <h5 class="text-primary mb-2">Hand Selection</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input hand-radio" type="radio" name="handSelect" id="right-hand" value="right" checked>
                                    <label class="form-check-label" for="right-hand">Right Hand</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input hand-radio" type="radio" name="handSelect" id="left-hand" value="left">
                                    <label class="form-check-label" for="left-hand">Left Hand</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input hand-radio" type="radio" name="handSelect" id="alternate-hands" value="alternate">
                                    <label class="form-check-label" for="alternate-hands">Alternate Hands</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Chord Types -->
                    <div class="col-12 mb-3">
                        <h5 class="text-primary mb-2">Chord Types</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-major" value="major" checked>
                                    <label class="form-check-label" for="type-major">Major</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-minor" value="minor" checked>
                                    <label class="form-check-label" for="type-minor">Minor</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-dominant7" value="dominant7" checked>
                                    <label class="form-check-label" for="type-dominant7">7th</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-major7" value="major7" checked>
                                    <label class="form-check-label" for="type-major7">Major 7th</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-diminished" value="diminished" checked>
                                    <label class="form-check-label" for="type-diminished">Diminished</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-minor7" value="minor7">
                                    <label class="form-check-label" for="type-minor7">Minor 7th</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-augmented" value="augmented">
                                    <label class="form-check-label" for="type-augmented">Augmented</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-sus2" value="sus2">
                                    <label class="form-check-label" for="type-sus2">Sus2</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-sus4" value="sus4">
                                    <label class="form-check-label" for="type-sus4">Sus4</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Inversions section -->
                    <div class="col-12 mb-3">
                        <h5 class="text-primary mb-2">Inversions</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input inversion-checkbox" type="checkbox" id="inv-root" value="root" checked>
                                    <label class="form-check-label" for="inv-root">Root Position</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input inversion-checkbox" type="checkbox" id="inv-first" value="first">
                                    <label class="form-check-label" for="inv-first">First Inversion</label>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <div class="form-check">
                                    <input class="form-check-input inversion-checkbox" type="checkbox" id="inv-second" value="second">
                                    <label class="form-check-label" for="inv-second">Second Inversion</label>
                                </div>
                            </div>
                            <div class="checkbox-item" style="margin-top: 10px; width: 100%;">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="slash-notation" checked>
                                    <label class="form-check-label" for="slash-notation">
                                        <span class="fw-bold">Slash Notation</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Progression Settings -->
                    <div class="col-12 mb-3">
                        <h5 class="text-primary mb-2">Progression Settings</h5>
                        <div class="row">
                            <div class="col-12 mb-2">
                                <label for="progression-style" class="form-label">Progression Style:</label>
                                <select id="progression-style" class="form-select">
                                    <option value="Random">Random</option>
                                    <option value="Common">Common: I-IV-V-I</option>
                                    <option value="Pop 1">Pop 1: I-V-vi-IV</option>
                                    <option value="Pop 2">Pop 2: vi-IV-I-V</option>
                                    <option value="Jazz & Classical Standard">Jazz & Classical Standard: ii-V-I</option>
                                    <option value="12-Bar Blues">12-Bar Blues: I-I-I-I IV-IV-I-I V-IV-I-I</option>
                                    <option value="Doo-Wop">Doo-Wop: I-vi-ii-V</option>
                                    <option value="Classic Rock">Classic Rock: I-bVII-bVI-V</option>
                                    <option value="Basic Circle of Fifths">Basic Circle of Fifths: I-V-II-VI-III-IV-I</option>
                                    <option value="Common Major Circle of Fifths">Common Major Circle of Fifths: I-IV-vii°-iii-vi-ii-V-I</option>
                                    <option value="Jazz-Friendly Circle of Fifths">Jazz-Friendly Circle of Fifths: ii7-V7-Imaj7-IVmaj7-viiø-III7-vi7-II7-V7</option>
                                    <option value="Minor Key Circle of Fifths">Minor Key Circle of Fifths: i-iv-♭VII-♭III-♭VI-ii°-V-i</option>
                                    <option value="Harmonic Minor Circle of Fifths">Harmonic Minor Circle of Fifths: i-iv-♭VII-♭III-♭VI-ii°-V7-i</option>
                                </select>
                            </div>
                            <div class="col-6 mb-2">
                                <label for="length" class="form-label">Length:</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="length" class="form-control" value="16" min="2" max="100">
                                    <span class="input-group-text">chords</span>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <label for="tempo" class="form-label">Tempo:</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="tempo" class="form-control" value="60" min="30" max="240">
                                    <span class="input-group-text">BPM</span>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <label for="beats" class="form-label">Beats per chord:</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="beats" class="form-control" value="4" min="1" max="16">
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <label for="lead-in-beats" class="form-label">Lead-in beats:</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="lead-in-beats" class="form-control" value="4" min="0" max="16">
                                    <span class="input-group-text">beats</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="container main-content">
        <div class="row">
            <div class="col-lg-12">
                <!-- Control Buttons Panel -->
 <!-- Updated Control Buttons Panel -->
<div class="card control-panel">
    <div class="card-body d-flex justify-content-center">
        <div class="control-actions d-flex">
            <div class="form-check form-switch me-3 d-flex align-items-center">
                <input class="form-check-input" type="checkbox" id="practice-beats">
                <label class="form-check-label ms-2" for="practice-beats">
                    <span class="fw-bold">Add practice beats</span>
                </label>
            </div>
            <button id="start-btn" class="btn btn-primary btn-lg">
                <i class="bi bi-play-fill"></i> Play
            </button>
            <button id="step-btn" class="btn btn-success btn-lg">
                <i class="bi bi-skip-forward-fill"></i> Step
            </button>
            <button id="rewind-btn" class="btn btn-success btn-lg">
                <i class="bi bi-rewind-fill"></i> Back
            </button>
            <button id="stop-btn" class="btn btn-danger btn-lg" disabled>
                <i class="bi bi-stop-fill"></i> Stop
            </button>
        </div>
    </div>
</div>

                <!-- Display Area -->
                <div class="card">
                    <div class="card-body p-3">
                        <div id="progression-display" class="progression-display"></div>
                    </div>
                </div>

                <!-- Piano Keyboard -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-music-note me-2"></i>Piano</h5>
                    </div>
                    <div class="card-body p-0 position-relative">
                        <div id="countdown-display" class="countdown-container hidden">
                            <div class="countdown">3</div>
                        </div>
                        <div class="piano-container">
                            <div id="piano" class="piano"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Selected Style Display with BPM Slider (horizontal layout) -->
    <div class="bottom-controls-container">
        <div id="style-display-container" class="style-display-container">
            <div id="style-display" class="style-display">Random</div>
        </div>
        <div class="bpm-slider-container">
            <label for="bpm-slider">BPM</label>
            <input type="range" id="bpm-slider" min="10" max="240" value="60" class="bpm-range">
            <span id="bpm-value">60</span>
        </div>
    </div>

    <!-- Footer -->
    <div class="blank-space"></div>
    <div class="footer-bar">
        <i>&copy; 2025. pianochordsuk@gmail.com     Soli Deo Gloria</i>
    </div>


    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <!-- App Scripts -->
    <script src="security.js"></script>
    <script src="music-theory.js"></script>
    <script src="tone-audio-engine.js"></script>
    <script src="piano-display.js"></script>
    <script src="practice-logic.js"></script>
    <script src="app.js"></script>
</body>
</html>