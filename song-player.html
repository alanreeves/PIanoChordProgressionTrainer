<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Song Library - pianochords.uk</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#7e57c2">
    <meta name="description" content="Interactive piano chord progression training app - Song Library">
    
    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PianoChords">
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png">
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="/icons/icon-512x512.png">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#7e57c2">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-96x96.png">
    <link rel="shortcut icon" href="/icons/icon-96x96.png">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Custom Styles -->
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Header Bar -->
    <header class="app-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-4 col-lg-6">
                    <h1 class="app-title">pianochords.uk</h1>
                </div>
                <div class="col-8 col-lg-6 text-end">
                    <!-- Navigation button to Random Practice -->
                    <button id="random-practice-btn" class="btn btn-sm btn-outline-light me-1 px-1 px-sm-2" title="Switch to Random Practice">
                        <i class="bi bi-shuffle"></i><span class="d-none d-md-inline ms-1">Random</span>
                    </button>
                    <!-- Metronome On/Off toggle button in header -->
                    <div class="form-check form-switch d-inline-block me-0 me-md-1">
                        <input class="form-check-input" type="checkbox" id="header-metronome">
                        <label class="form-check-label text-white" for="header-metronome">
                            <span class="fw-bold d-none d-md-inline">Met</span>
                            <span class="fw-bold d-inline d-md-none"><i class="bi bi-music-note"></i></span>
                        </label>
                    </div>
                    <!-- Audio On/Off toggle button in header -->
                    <div class="form-check form-switch d-inline-block me-0 me-md-1">
                        <input class="form-check-input" type="checkbox" id="header-play-sound">
                        <label class="form-check-label text-white" for="header-play-sound">
                            <span class="fw-bold d-none d-md-inline">Audio</span>
                            <span class="fw-bold d-inline d-md-none"><i class="bi bi-volume-up"></i></span>
                        </label>
                    </div>
                    <button id="settings-btn" class="btn btn-sm btn-outline-light me-1 px-1 px-sm-2">
                        <i class="bi bi-gear-fill"></i><span class="d-none d-lg-inline ms-1">Settings</span>
                    </button>
                    <button id="help-btn" class="btn btn-sm btn-outline-light px-1 px-sm-2" data-bs-toggle="modal" data-bs-target="#helpModal">
                        <i class="bi bi-question-circle"></i><span class="d-none d-lg-inline ms-1">Help</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Song Library - How to Use</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Song Selection</h6>
                    <p>Select a song from the dropdown in the Settings panel. The chord progression will display with individual timing for each chord.</p>
                    <h6>Key Transposition</h6>
                    <p>Choose a different key to practice the song in. All chords will be automatically transposed while maintaining their type and inversion.</p>
                    <h6>Playback Controls</h6>
                    <ul>
                        <li><strong>Play:</strong> Start playback from the beginning</li>
                        <li><strong>Step:</strong> Advance to the next chord (respects individual timing)</li>
                        <li><strong>Back:</strong> Return to the previous chord</li>
                        <li><strong>Stop:</strong> Stop playback and reset</li>
                    </ul>
                    <h6>Chord Duration Display</h6>
                    <p>Each chord pill shows a duration badge indicating how long that chord plays. This helps you practice with realistic song timings.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Dropdown Panel -->
    <div class="settings-dropdown-container">
        <div class="settings-overlay"></div>
        <div class="settings-dropdown">
            <div class="settings-dropdown-header">
                <h5><i class="bi bi-gear-fill me-2"></i>Settings</h5>
                <button class="settings-close-btn">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="settings-dropdown-content">
                <!-- Song Selection Section -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">Song Library</h5>
                    <div class="row">
                        <div class="col-12 mb-2">
                            <label for="song-select" class="form-label">Select a Song:</label>
                            <select id="song-select" class="form-select">
                                <option value="">-- Choose a song --</option>
                            </select>
                        </div>
                        <div class="col-12 mb-2">
                            <div id="song-info" style="display: none;">
                                <div><strong>Title:</strong> <span id="song-title"></span></div>
                                <div><strong>Composer:</strong> <span id="song-composer"></span></div>
                                <div><strong>Original Key:</strong> <span id="song-key"></span></div>
                                <div><strong>Time Signature:</strong> <span id="song-time-sig"></span></div>
                                <div><strong>Tempo:</strong> <span id="song-tempo"></span> BPM</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <label for="transpose-key" class="form-label">Play in Key:</label>
                            <select id="transpose-key" class="form-select" disabled>
                                <!-- Major keys -->
                                <option value="C">C Major</option>
                                <option value="C#">C# Major</option>
                                <option value="Db">Db Major</option>
                                <option value="D">D Major</option>
                                <option value="D#">D# Major</option>
                                <option value="Eb">Eb Major</option>
                                <option value="E">E Major</option>
                                <option value="F">F Major</option>
                                <option value="F#">F# Major</option>
                                <option value="Gb">Gb Major</option>
                                <option value="G">G Major</option>
                                <option value="G#">G# Major</option>
                                <option value="Ab">Ab Major</option>
                                <option value="A">A Major</option>
                                <option value="A#">A# Major</option>
                                <option value="Bb">Bb Major</option>
                                <option value="B">B Major</option>
                                
                                <!-- Minor keys -->
                                <option value="Cm">C Minor</option>
                                <option value="C#m">C# Minor</option>
                                <option value="Dbm">Db Minor</option>
                                <option value="Dm">D Minor</option>
                                <option value="D#m">D# Minor</option>
                                <option value="Ebm">Eb Minor</option>
                                <option value="Em">E Minor</option>
                                <option value="Fm">F Minor</option>
                                <option value="F#m">F# Minor</option>
                                <option value="Gbm">Gb Minor</option>
                                <option value="Gm">G Minor</option>
                                <option value="G#m">G# Minor</option>
                                <option value="Abm">Ab Minor</option>
                                <option value="Am">A Minor</option>
                                <option value="A#m">A# Minor</option>
                                <option value="Bbm">Bb Minor</option>
                                <option value="Bm">B Minor</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Playback Controls Section -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">Playback Controls</h5>
                    <div class="row playback-row">
                        <div class="col-12 mb-2">
                            <div class="form-check form-switch d-flex align-items-center">
                                <input class="form-check-input" type="checkbox" id="play-sound">
                                <label class="form-check-label" for="play-sound">
                                    <span class="fw-bold">Audio On/Off</span>
                                </label>
                                <div class="compact-volume-control">
                                    <label for="chord-volume" class="small">Vol</label>
                                    <input type="range" class="compact-range" id="chord-volume" min="0" max="1" step="0.01" value="0.5">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="arpeggiate-chord">
                                <label class="form-check-label" for="arpeggiate-chord">
                                    <span class="fw-bold">Arpeggiate</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="d-flex align-items-center">
                                <label for="octave-selector" class="me-2">
                                    <span class="fw-bold">Octave:</span>
                                </label>
                                <select id="octave-selector" class="form-select form-select-sm" style="width: auto; min-width: 70px;">
                                    <option value="3">3 (Low)</option>
                                    <option value="4" selected>4 (Middle)</option>
                                    <option value="5">5 (High)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="form-check form-switch d-flex align-items-center">
                                <input class="form-check-input" type="checkbox" id="metronome">
                                <label class="form-check-label" for="metronome">
                                    <span class="fw-bold">Metronome</span>
                                </label>
                                <div class="compact-volume-control">
                                    <label for="metronome-volume" class="small">Vol</label>
                                    <input type="range" class="compact-range" id="metronome-volume" min="0" max="1" step="0.01" value="0.5">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Lead-in Beats Section -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">Practice Settings</h5>
                    <div class="row">
                        <div class="col-6 mb-2">
                            <label for="lead-in-beats" class="form-label">Lead-in beats:</label>
                            <div class="input-group input-group-sm">
                                <input type="number" id="lead-in-beats" class="form-control" value="4" min="0" max="16">
                                <span class="input-group-text">beats</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hand Selection -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">Hand Selection</h5>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input hand-radio" type="radio" name="handSelect" id="right-hand" value="right" checked>
                                <label class="form-check-label" for="right-hand">Right Hand</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input hand-radio" type="radio" name="handSelect" id="left-hand" value="left">
                                <label class="form-check-label" for="left-hand">Left Hand</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input hand-radio" type="radio" name="handSelect" id="alternate-hands" value="alternate">
                                <label class="form-check-label" for="alternate-hands">Alternate Hands</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chord Types -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">Chord Types</h5>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-major" value="major" checked>
                                <label class="form-check-label" for="type-major">Major</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-minor" value="minor" checked>
                                <label class="form-check-label" for="type-minor">Minor</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-dominant7" value="dominant7" checked>
                                <label class="form-check-label" for="type-dominant7">7th</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-major7" value="major7" checked>
                                <label class="form-check-label" for="type-major7">Major 7th</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-diminished" value="diminished" checked>
                                <label class="form-check-label" for="type-diminished">Diminished</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-minor7" value="minor7">
                                <label class="form-check-label" for="type-minor7">Minor 7th</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-half-diminished" value="half-diminished">
                                <label class="form-check-label" for="type-half-diminished">Half-Diminished (Ã¸)</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-augmented" value="augmented">
                                <label class="form-check-label" for="type-augmented">Augmented</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-sus2" value="sus2">
                                <label class="form-check-label" for="type-sus2">Sus2</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-sus4" value="sus4">
                                <label class="form-check-label" for="type-sus4">Sus4</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input chord-type-checkbox" type="checkbox" id="type-add9" value="add9">
                                <label class="form-check-label" for="type-add9">Add9</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inversions section -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">Inversions</h5>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input inversion-checkbox" type="checkbox" id="inv-root" value="root" checked>
                                <label class="form-check-label" for="inv-root">Root Position</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input inversion-checkbox" type="checkbox" id="inv-first" value="first" checked>
                                <label class="form-check-label" for="inv-first">First Inversion</label>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <div class="form-check">
                                <input class="form-check-input inversion-checkbox" type="checkbox" id="inv-second" value="second" checked>
                                <label class="form-check-label" for="inv-second">Second Inversion</label>
                            </div>
                        </div>
                        <div class="checkbox-item" style="margin-top: 10px; width: 100%;">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="slash-notation" checked>
                                <label class="form-check-label" for="slash-notation">
                                    <span class="fw-bold">Slash Notation</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PWA Controls -->
                <div class="col-12 mb-3">
                    <h5 class="text-primary mb-2">App Info</h5>
                    <div class="row">
                        <div class="col-12 mb-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <span><strong>Version:</strong> <span id="app-version-display">Loading...</span></span>
                                <button id="check-update-btn" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-arrow-clockwise"></i> Check for Updates
                                </button>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <span id="app-status"><i class="bi bi-circle-fill text-success"></i> Ready</span>
                                <span id="connection-status" class="small text-muted">Online</span>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <span><strong>Installation:</strong> <span id="install-status">Not Installed</span></span>
                                <button id="install-app-btn" class="btn btn-sm btn-success" style="display: none;">
                                    <i class="bi bi-download"></i> Install App
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="container main-content">
        <div class="row">
            <div class="col-lg-12">
                <!-- Control Buttons Panel -->
                <div class="card control-panel">
                    <div class="card-body d-flex justify-content-center">
                        <div class="control-actions d-flex">
                            <div class="form-check form-switch me-3 d-flex align-items-center">
                                <input class="form-check-input" type="checkbox" id="practice-beats">
                                <label class="form-check-label ms-2" for="practice-beats">
                                    <span class="fw-bold">Add practice beats</span>
                                </label>
                            </div>
                            <button id="start-btn" class="btn btn-primary btn-lg">
                                <i class="bi bi-play-fill"></i> Play
                            </button>
                            <button id="step-btn" class="btn btn-success btn-lg">
                                <i class="bi bi-skip-forward-fill"></i> Step
                            </button>
                            <button id="rewind-btn" class="btn btn-success btn-lg">
                                <i class="bi bi-rewind-fill"></i> Back
                            </button>
                            <button id="stop-btn" class="btn btn-danger btn-lg" disabled>
                                <i class="bi bi-stop-fill"></i> Stop
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Display Area -->
                <div class="card">
                    <div class="card-body p-3">
                        <div id="progression-display" class="progression-display"></div>
                    </div>
                </div>

                <!-- Piano Keyboard -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-music-note me-2"></i>Piano</h5>
                    </div>
                    <div class="card-body p-0 position-relative">
                        <div id="countdown-display" class="countdown-container hidden">
                            <div class="countdown">3</div>
                        </div>
                        <div class="piano-container">
                            <div id="piano" class="piano"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Selected Song Display with BPM Info (horizontal layout) -->
    <div class="bottom-controls-container">
        <div id="song-display-container" class="style-display-container">
            <div id="song-display" class="style-display">Select a song</div>
        </div>
        <div class="bpm-slider-container">
            <label for="bpm-slider">BPM</label>
            <input type="range" id="bpm-slider" min="10" max="240" value="60" class="bpm-range" disabled>
            <span id="bpm-value">60</span>
        </div>
    </div>

    <!-- Footer -->
    <div class="blank-space"></div>
    <div class="footer-bar">
        <span><i>&copy; 2025. pianochordsuk@gmail.com     Soli Deo Gloria</i></span>
        <span id="footer-version" style="font-size: 0.8rem; margin-left: auto;">v<span id="version-number">loading</span></span>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <!-- App Scripts -->
    <script src="security.js"></script>
    <script src="music-theory.js"></script>
    <script src="tone-audio-engine.js"></script>
    <script src="piano-display.js"></script>
    <script src="song-player-audio.js"></script>
    <script src="song-player-logic.js"></script>
</body>
</html>
